language: generic
sudo: required

services:
- docker

env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: Uba+7jp8tt0gnzC4SPULioV9UR5MuQsREIBIGKcNJJwIQrm1P/JYffDB+jzZwbrVxPzbTFcIWYTOQW80nmWHkr5q+QmXpCCePdDfhLe1++W4/TW8rJ+tsDcsUdUq6ionKbYgfrysnQIAGyNldY8AlgLqi9XA28oNvDbNvSfvJwzvQ4oQk+XtqpCVjFt+h0EKcDP65c1Up1Z0KbkT2h4sK4gWvx9P6bPfE8+N8JOED8pLdoqdPswbzAQv4Fa9BmoXut3g6seX2J2n8PkNayhHIkOABtMfoXEMh9U9ZvHqKHN1w1R0D8AQaA4HXoztRikXZ3Ymur3A8JAr7iGEVC8ypsrKfeQUI0S/k0OIKtGYJmvDUJlf5E6fgyT6fLBlfr0zGALAzUIP/cSMrXI883xiEeR94d4hipWFDWPKrqaX0kBGEIOdUV566M0LacMuwRxTuturH+o0/5RCNbTC9mOgk8geepc/SJGo7Z1OI8KMKDQt3eh5mrepPRmHkfup0zX02qHPLz3P9pgMBulDlAOW/ZsgJzq4Oq77cdMeqyEyEitCsxJAzV3J8misYsxspBHLv47TVd0ep0P91YcWR/ESNtSMJI2OvoEirBmVJq7CHuvTzRtv5nbjO7y8TDNPiaq8/Te8d/XfEGykwKEdknfkGLezO6gh5kFnRyUJ0HXgLV8=
  - secure: JiDvxUvPUbqlxRdkxNiHsjT040JAvzPWwi4UpMuBu2Yfg0hAvB/0cb+d51xiOxY1/ph7BBjSXJRRyKDx+v5jJHNF2iZGIOzDSLgN/CxuErBbq1pqfnrwSQ9fTp5+kyuWZYeiXI1TjMYYFjIYXY9zUZCmWSB5sJ2rUuCazbxbEnJC0gRY4frOt/a9heiVKVfDXNgaFgEt9KZdPn524OV5AvakfvMxLvNpJQ9ybOPmJ4KFxVR3ME3ZTt5+XY1TWpItnEf8QSkdTueF3OiIo+REjE9It1v1o0hXs42214QRL6qN/9gp7iPnz7yXeLAeNIu/Vfz2zx8I6shyrwzDom1OIWNkk9NU5b7UfqQOhoKa/Uea5ax/H76iDfKHulUPWx3ac2ezpewju+duyW+6CeeZgQ4dCRtYFzPSwk5T1KoJXuBZn8gSGWOiqokWD7GtJ45ah+L6+Lv8WoogjwZdHh1nO5bQu43nvh0ewNlNhaHI1e0w2EnxWfAfct5OX0bmzVcyMsj1jdVrBo/dR/JTmsqXwCEH3igv8WK7gSZoQSUVPOxV+SqbwCsQe27wGbZE3RSU5nZa0DGgQc5rb4yoPAL9BCjLgYEWfC07PXfAS0qAWuotkM2BSVxlx9QTmXcSCkOU023DHloH0LnkxBukTZspbr7VGDZqKlNy8Bga3LzSHfo=
  - secure: ljo5tcRmfc3gXigWqxtOknhsAZwEsXCC2sTh2d7TWFZtApXk0PFExcZ30ZZophYfpaN6fDnS7NLlY2YBH22wSXoticM/qMGrYG0BePUNY2qyyTid00otTH+CmEsl8CAbAX0psO9EWCde6KFGh40fRVJKGq6smbmLs7eDYePPq5wbHCc2NIbU3c3jx1aSFoJP0Y9fGamY8Lk7KOKLvrQFFNHInPn0nGHLH/8/UE2KDocXlrFagIQTW5kO3XbQi07EW7VWY68/pjwMeqv2v1Y1l88k2MtVHSXGpywvz80CsvuwjCZEtE2oGn4A2Uh6Wb/RalQw/K0l37a8dzMaPTyG9ltNZ9rJZzD5fcCmX2boCYwbnmjfbErDI8cb7Ct5CJqd4mwjE1LcMOkLDR7hoVQGp0wZZx26Z6f22N9J1WRvapwwdf05xH+MbRKqUp8+0G5WMF+pzHNH3THbmsTll75NqZSwGFHoe/SoRjKmYIzj1S5mXnurMTrC2J6sGVg2elcynPCx8gzzpgHwqeGokqbNgKzXzVdCORXy+wwlOv+P90S3EQWLeQRHP/WaJU0NZImJwQcKNiuwaQMtidda4H9qYSso1M/yHR32DtE/6z7fsq3GhEgFbTPH7reAGQkh2UICuZLrbmP2hbhdeqfRpqR3Rn+mCasrD/CkWkGmP3bRGgo=
  - secure: e+R0b0En54Nvu+87BVIZnPwJCPcv0Jgb8IZZ+yIh222+i3Pj8vLb6jK31T6IrqH9hJ7lc8CrMs8lfEzvwjWzP6y0tNma0Yxuu7VK5TJA8/R9v5YPhrVAtwdgAlEOlb8Y2ZlcDSziRHgcSsP2MPjQfCMnohRpIAHKV70+uPVD/X0OQEDIlNRPk5RCn6X5wF7pRBls0FP1ORZglYI3wvFxmKuHU+BrfjUQvQiblKZTfyo5ffnG0J6TOs3DOUdbUcMzThr2cbpY4WKfidRBScQ4Vkhq76/lpt205QLBBQgXqwccq7QZbaxPeUxMNhmC3p2L5zrsoQFaYsBZGd6hd4C6cg+q4ueeorEA1kpM1ZQu37kDdqKowVL6Y+/juN0eBmK9rGi+VW3epcoEtWdaAFnoeBaaPLrfAwXS5Ovnjv9Tsr0aeNYcT8zKxtp/418dhBpltT9NopkhQBv3RJE3kecVme+dbEPW43YTSgLgl4U6s/7IBBTnEpnkdFidwZqu+4b8HvAVg2oL43vN7O7/2luqPssw+64VUctglMzuwvlkTb18g67hTZSiv2TCuLmEQsk780mBlT+Nz6BFfM5kmNx9gnCk2hXY6AH9QAi/UofOrNYCQ5HAMgqtCIFxyFaJzmHvNKEjaSDGx6YlhaJrPbvKwMckhOTegPzeekKzeo/Ud3Y=
  - secure: mGPW/JRwb81fr7XXntQ8ArGHKI2wWenu0Ujf2PGm5Ob34w+xsFGdY0Cyw2SQVoVoPIF131mXRuvx7yPZDq0KSCTIVepoplUcBWnEsTnW8+rpYCzQtyJBVndsamJLTbjGF4K73ZvEmHzd/ScwO5YUJDy5Uv+XfJ0SwG/XR1cs0E4Yd3fQAkC3G3dQvk1TWN1+kbPmblTPweTLQqjEG1lsWXwUw3x82IMwd/5ZFwUoqqLSfb33oWNJ9iFIOzfCX7PGdg0TzrMcJmvhAZyZiC4FluzHb5raL91kXh0z1172XQhfm7Oss5RBTPRLbqtNH+3R+KSFzrGyDLLpA/iIOIygID2mT2LBHWYXjtHfVRPK7jUj8IFVqKGxWhC/512tMldnkNNHfKPahR5iKd1NR3EhcrFDVDryH8RCk0UQn+MoqSSQg26PiBJeVxOmBY6WSiFuXRcl+Gg3qeF5LSBWChXxfX+pQEuyTWNdnU9VPhj8d8lpqqAF0bAr2gRBiA8aiWBzRNLj4lMT4XkaG1C8BKJ8y7nvlJwyzmkpo8k6nC6KU5ITe+QGmtfUoUHY6JbvM+fYfWRaUIrMW3spwSMJ4aEGdrn1NbbRz9FjsrMper9JDkRt36jTEygng6GyX9QIuN+SW0z6MPm869/GUOvv6S9OL3DgFw/jT412ZgumSh7ru24=
  - secure: Jw31s+c48pXdbKYe2j5IaKU8OtLuPe+aOeqL+NEMgaCYKK58WCzcA2KnNCCOSuxfkQLHidd+UqZ4iHhZUWemLacoArUbvwo6kCtbQTQe3OzUDrbHLnmv/s4pBzL+dlato0gX7rT14pjBzq2+yTtZ7QIoSJuRkjkliqNKWhNiQMD3ZpZZUDsfRsqLusrfS00EOu4hahiE14ey8rSWVHpdKbTKiGkkgGnn4x6UzgrSarLsN83RHf8u7CLaXLy7Zp7fz7CC8M2ZDL2Hf0m26JHN4U+aYpKPye5qyu1IHus31pcrRLTtxi+57nlH+M87JSrZp5TfMcuXcEphSAfXS6eCcu1sq2+ke12jGtDlQ4ntahxnINq1HWN3EMFtN+HtFB5TRii63PyS1c8W1Ql/rRxSUAkjtZ6smY+FOXf9ubK3s/cYqpxtxSXc9Y3ZacajbHxZh1Txa110KJK7L+g/VqBtA4ldSaVy2HokW9qndD3jlV7/eif0pKJGd1JM9tOYKmd7iQokwWezrEfkOsz6cwe5N3tyfunJg6vITeEUC6PujnBnSJTNLazQb/b3ClrMhE5UBm3gO7v9sacEDet8BceP7j1nTAkG7NGlqQYg72W4nN+56fGbwuEdBXk8vT3Pq0rK8xueDeR+RMHKIx/1Dh4npx4yP3zEvESCGxE9gixzPY8=
  - secure: Ib6PCwOIhNYCMfyxQMWqmnP8KYX+Ql+uijHBa0O5x7nv3EIvqvCrCAxHI13TT2QJ6Sgsera1L+kglLlujuMcU0Y9di0PxfsnHQ/2+6sCZXKb1kZ/Er9zVSlq3r8b0Bah4bkoa6X0XcYkWdqiFvJSgXPQeBxCtZPDbX/ONG2c0xCirOcrNQHX3JzlA+N9Wc0fc/KKFRDNQlYZRv38pBtPGD5E8MATvKI1cNOp5hQfU/XHC1mDOfQbZhwBwDXDnIGe/yv5+bB4EPKKcWkp34XVWAc0JDJZA4LTjM0Ji6YOjXMjJNQq/sp/6Himk+fDw9b/ZvkJIDjAujyK0Hbi5WQpWG4R1piPwTiFqkqkhe1irk+ys9/PvmIukVdSniXRca1FrSAEz4VJgoKxHDTKLTGXB3tfxDaHJ0ywhGRBPI+MqsXNdTaHgkaGmUj3VYLg5w6MoJomEtdvAZTPRhbCwxBaX6gvTRNEjPqNaP7Vp/xw0337srpRYrCo/3AVAzHeIPAjCvsBcMGOQTZB6zTohSg8PwlBpXwfxsUJ5SwYScpwnbfwC7F13F9u5Wl+gFBAV/9rWgzSWQbOYEPa99g+aGj2njchuwvOjtKbw1aAcCz1MRPspanE13kkDB+ofBDjsMhZ02/oMvn/U/Bpw84SohmLHHMRE4F7Ay2KqtsyUnoFw9E=
  - secure: uFQg/o66WaoADVL0Q7jRHC1Dpy/Pjogunh6Gsx3SL5s+W3tzpfS4g8Su25Q9U3GUktlA1tJa2mjTAXMdwNnW7rEu2hOa1A6MxrT/cwOtEu6V+tDj6Wze2qfJ1ofGL2mQH4k+v7KNyzw9B8kC2ItzyuTGvi2OQLIicyzSIBgyntV9imGCEfwXrBQ2HMumrpq/yXDwLxpd0oEOZ+4G9PwApyHV49AuiJDE8N5qIdz0MyBh3s78CFELWT9farbpieORi8H5uCVmFgZyA8eCOKnnczCwrQbfmQndbUIFJljkxsIX57I2ltqnNArRZthMLOmHtziAUv3Iu6b+X9441cBlaOGr4G7lxAzdvEYUCzc4fS2X73MelolGBV4Cqkp3dNtlT5h7cP0MC1T0lNBP4ph+iZwC8D7RryaOipIOFG//GkX2ydzwMakxZxvlAfUlwU/Dh2E9qI0ufIy7PwxuTJ7a+fTon60gwOT+LQ3mPyjLTbToZhAODBI5uURBoVLrJIhdAjQxEl1pJA+uy+Bmq50YhADTq1b/rCQP3g3GJF1POy0ivDJFgVGGYrfCeYcMQ3kl+Xfa1RQaaM5PPmok3TJf2BjPkKZRyDM6CYDoH5RE+gJ6VPECncu3sx79/mjrNJazFl3apfB/iQUrKgRNmzc/BoUkui+mBqFmFh5/pZfAjkk=

before_install:
  - echo "$DOCKER_PASS" | docker login -u $DOCKER_USER --password-stdin

install:
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - docker build -f Dockerfile -t $TRAVIS_REPO_SLUG:$TAG .
  - docker tag $TRAVIS_REPO_SLUG:$TAG $TRAVIS_REPO_SLUG:$COMMIT
  - docker push $TRAVIS_REPO_SLUG

script: true

deploy:
  skip_cleanup: true
  provider: script
  script:
    - "./scripts/deploy.sh"
  on:
    tags: true
    branch:
      - master
      - "/(\\d+\\.)?(\\d+\\.)?(\\*|\\d+)$/"
